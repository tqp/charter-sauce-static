var App = (function(window){
  "use strict";
  var _this = null;
  var cacheCollection = {}; 
  var actz = "m-customizer";
  var wow = new WOW(
        {
          animateClass: 'animated',
          offset:       100,
          callback:     function(box) { 
          }
        }
      );
  wow.init();
  return {
    init : function(){
      _this = this;

      /* Content Size */
      this.ContentSize();

      /* Main Slider */
      this.MainSlider();    

      /* News Post */
      this.NewsPostMore();

      /* Search Form */
      this.SearchForm();

      /* Category Filter */
      this.CatFilter();

      /* Color Customizer */
      this.ColorSelector(); 
      this.ColorCustomizer();
      
      $(window).resize(function() {
        /* Content Size */
        App.ContentSize();
      });
      $(document).on('click', function(e) {
        if($(e.target).parents('.'+actz+'').length == 0 && !$(e.target).hasClass(''+actz+'')){
          $("."+actz+"").removeClass('m-customizer_toggle');
          $("body").removeClass('m-body_overlay');
        }
      });  

      var mcn = _this.getObject('.m-counter_number'); 
      if (mcn.length > 0){
        mcn.counterUp({ delay: 100, time: 3000 });
      }
      var rotate = _this.getObject("#scroller");
      if (rotate.length > 0){
        rotate.simplyScroll(); 
      }   

    },

    getObject: function(selector){
      if(typeof cacheCollection[selector] == "undefined"){
        cacheCollection[selector] = $(selector);
      }
      return cacheCollection[selector];
    },

    ContentSize: function(){
      var mch = '.m-content_half';
      var mbt = ".m-blogpost_topside";
      var mpc = ".m-page_content";
      if (_this.getObject(mch).length > 0){
        var window_width = $(window).width();
        if(window_width > 767){
          var offset_left = $('.container').offset().left;
          var content_width = $(window).width() - offset_left -15;
          _this.getObject(mpc).css("width", content_width);
          var content_half = $(mch).width();
          var blogside = content_half - offset_left -15;
          _this.getObject(mbt).css("max-width", blogside);
        }else{
          _this.getObject(mpc).css("width", "100%");
          _this.getObject(mbt).css("max-width", "100%");
        }
      }
    },

    MainSlider: function(){
      var mhs = '#m-home_slider';
      if (_this.getObject(mhs).length > 0){
        var main_slider = _this.getObject(mhs).bxSlider({ 
          controls: false,
          auto: true,
          mode : "fade",
          speed: 1500 
        });
        _this.getObject("#m-main_slide_left").on('click', function() {
          main_slider.goToPrevSlide();
        });
        _this.getObject("#m-main_slide_right").on('click', function() {
          main_slider.goToNextSlide();
        });
      }
    },
    
    NewsPostMore: function(){
      var mnm = "#m-newspost_more";
      var mnl = ".m-newspost_listing > div";
      var mn = ".m-newspost_listing";
      _this.getObject(mnm).on("click",function(){
        var i = 0;
        var n = _this.getObject(mnl).length;
        var j = 0; 
        var data_show = $(mn).attr("data-show");
        _this.getObject(mnl).each(function( index ) { 

          var data_attr = $(this).attr("data-attr"); 
          if(data_attr == 0){
            if(i < data_show){
              $(this).fadeIn( "slow");
              $(this).attr("data-attr","1");
            }
            i++;
          }
          if(data_attr == 1){
            j++;
          }
        }); 
        var total_show = parseInt(j)+parseInt(data_show);
        if(total_show >= n){
          _this.getObject(mnm).addClass("disable");
        }
      });
    },

    SearchForm: function(){
      var ms = "#m-search";
      var msf = ".m-search_form";
      var msfi = ".m-search_form input";
      var mcs  = "#m-close_search";

      _this.getObject(ms).on("click",function(){
        _this.getObject(msf).fadeIn();
        _this.getObject(msfi).focus();
        return false;
      });
      _this.getObject(mcs).on("click",function(){
        _this.getObject(msf).fadeOut();
        _this.getObject(msfi).val("");
        return false;
      });
    },

    CatFilter: function(){
      var mbb = ".m-bloglist_top > div.col-lg-8 div.m-blog_box";
      var mbf = "#m-blog_filter > ul > li";
      _this.getObject(mbf).on("click",function(){
        _this.getObject(mbf).removeClass("m-active_cat");
        $(this).addClass("m-active_cat");
        var cat_id = $(this).attr("data-id"); 
        if(cat_id != "m-all"){
          _this.getObject(mbb).parent().closest('div').fadeOut("slow");   
          _this.getObject(mbb).each(function() {
            var WorkAttrStrip = $(this).data('attr');
            var WorkAttr      = WorkAttrStrip.split(","); 
            if($.inArray(cat_id, WorkAttr) !== -1){
              $(this).parent().closest('div').fadeIn("slow"); 
            }
          });
        }else{
          _this.getObject(mbb).parent().closest('div').fadeIn("slow");  
        }
        return false;
      });
    },

    ColorSelector : function(){
      this.getObject("#m-selector_icon").on('click', function(event) {
        $("body").toggleClass('m-body_overlay');
        $(this).parent("."+actz+"").toggleClass(''+actz+'_toggle');
        return false;
      });
    },

    ColorCustomizer : function(){
      this.getObject("#m-color_selector > li").on('click', function(event) {  
          _this.getObject( "body" ).addClass('t-overlay');
          _this.ChkIt(this);
          _this.getObject("."+actz+"").removeClass('m-customizer_toggle');
          _this.getObject("body").removeClass('m-body_overlay');
          return false;
      });
    },

    ChkIt : function(color_rels){
      var Themes = {
        "color_1":"assets/css/themes/color_1.css",
        "color_2":"assets/css/themes/color_2.css",
        "color_3":"assets/css/themes/color_3.css",
        "color_4":"assets/css/themes/color_4.css",
        "color_5":"assets/css/themes/color_5.css",
        "color_6":"assets/css/themes/color_6.css",
        "color_7":"assets/css/themes/color_7.css",
        "color_8":"assets/css/themes/color_8.css",
      }; 
      var color_rel = $(color_rels).attr("data-attr");  
        if(Themes.hasOwnProperty(color_rel)){ 
          this.getObject(document).find("link#ThemeRoller").remove();
          this.SwitchTheme(Themes[color_rel]); 
        }
    },

    SwitchTheme : function(href){
      var wjs = document.createElement('link');
      wjs.type = 'text/css';
      wjs.id = 'ThemeRoller';
      wjs.async = true;
      wjs.rel="stylesheet";
      wjs.onload = function(){
        _this.getObject("body").removeClass('t-overlay');
      };
      wjs.href = href;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(wjs);
    }


  }
 
})(window);

/****** ANIMATION *****/
$(document).ready(function($) {
  App.init();
});